import{f as _,o as w}from"./AUJ76673.js";import{d as R}from"./MX3LYTPZ.js";import{a as x}from"./4B6UFNBQ.js";import{J as k,l as y}from"./XZ5AIA7R.js";import{f as E}from"./GAV6HCJA.js";var P=E(x());function O(o){if(o==null||typeof o=="boolean")return!0;if(typeof o=="string")return o.trim().length===0;if(typeof o=="number")return!1;if(Array.isArray(o))return o.every(e=>O(e));if(P.default.isValidElement(o)){let{props:e}=o;return e.children&&O(e.children)}return!0}var A=class{constructor(){this._events=new Map}on(e,t){this._events.has(e)||this._events.set(e,[]),this._events.get(e).push(t)}off(e,t){let r=this._events.get(e);r&&r.length&&this._events.set(e,r.filter(n=>n!==t))}once(e,t){let r=(...n)=>{this.off(e,r),t(...n)};this.on(e,r)}emit(e,...t){let r=this._events.get(e);r&&r.length&&r.forEach(n=>{n(...t)})}addListener(e,t){this.on(e,t)}removeListener(e,t){this.off(e,t)}removeAllListeners(e){e?this._events.delete(e):this._events.clear()}};var U=(o,e)=>{let t=new Uint8Array(o.length+e.length);return t.set(o,0),t.set(e,o.length),t};var F=class{constructor(e,t=2e3*1024){this.fileUrl=e;this.chunkSize=t;this.response=null;this.readableStream=null;this.fileBlob=null;this.fileInfo=null;this.abortController=null;this.bytesRead=0;this.fileUrl=decodeURIComponent(e)}async init(){this.abortController=new AbortController;let e=await fetch(this.fileUrl,{method:"GET",signal:this.abortController.signal});if(this.response=e,!e.ok)throw new Error(`HTTP error! status: ${e.status}`);if(!e.body||!e.body.getReader)throw new Error("Read file error\uFF01cannot read file");let t=e.headers.get("Content-Length"),r=e.headers.get("Content-Type"),n=e.headers.get("Last-Modified"),s=this.fileUrl.split("/").pop()?.split("?")[0]||"";return this.fileInfo={url:this.fileUrl,name:s,size:t?parseInt(t,10):0,type:r||"application/octet-stream",lastModified:n?new Date(n).getTime():void 0},!this.fileInfo.size&&k(this.fileUrl)?(this.fileBlob=await e.blob(),this.fileInfo.type=this.fileBlob.type,this.fileInfo.size=this.fileBlob.size):this.readableStream=e.body,this.fileInfo}async getNextChunk(e=this.chunkSize){let t={done:!0,value:new Uint8Array([]),progress:0};if(this.readableStream){let r=await this.getNextChunkByStream(e);r&&(t.done=r.done,t.value=r.value)}if(this.fileBlob){let r=await this.getNextChunkByBlob(e);r&&(t.done=r.done,t.value=r.value)}return t.done?t.progress=100:this.fileInfo?.size&&(t.progress=Math.round(this.bytesRead/this.fileInfo.size*100)),t}async getNextChunkByStream(e){if(!this.readableStream||!this.fileInfo)return null;let t=this.readableStream.getReader(),r=!1,n=new Uint8Array([]);for(;!r&&n.length<e&&this.readableStream;){let s=await t.read();r=s.done,s.value&&(n=U(n,s.value),this.bytesRead+=s.value.length)}return r||t.releaseLock(),{done:r,value:n}}async getNextChunkByBlob(e){if(!this.fileBlob||!this.fileInfo)return null;let t=await this.fileBlob.slice(this.bytesRead,this.bytesRead+e).arrayBuffer();return this.bytesRead+=t.byteLength,{done:this.bytesRead>=this.fileInfo.size,value:new Uint8Array(t)}}async destroy(){this.readableStream?.cancel(),this.abortController?.abort(),this.response=null,this.readableStream=null,this.fileBlob=null,this.fileInfo=null,this.abortController=null,this.bytesRead=0}};var B=class{constructor(e){this.module=e.split("/").map(t=>`[${t}]`).join("")}info(...e){if(!y)return;let t=this.getCallStack()}error(...e){if(!y)return;let t=this.getCallStack()}warn(...e){if(!y)return;let t=this.getCallStack()}debug(...e){if(!y)return;let t=this.getCallStack()}getCallStack(){let e=new Error().stack;return e?e.split(`
`).slice(2).join(`
`)?.split(/\n/)?.[1]:""}};var I=class{constructor(){this.pending=new Map}async send(e,t,r=5*1e3){let n=w(),s={...t,uuid:n};return new Promise(c=>{let l=setTimeout(()=>{this.pending.delete(n),c(void 0)},r);this.pending.set(n,i=>{clearTimeout(l),c(i)}),window.dispatchEvent(new CustomEvent(e,{detail:s}))})}receive(e,t){let r=async n=>{if(n instanceof CustomEvent&&n.detail&&n.detail.uuid){let{uuid:s,...c}=n.detail,l,i=t(c);if(i instanceof Promise?l=await i:l=i,l===void 0)return;let u=this.pending.get(s);u&&(u(l),this.pending.delete(s))}};return window.addEventListener(e,r),()=>{window.removeEventListener(e,r)}}},ne=new I;var V=_;var g=E(x()),f=E(x());var ue=o=>{let e=(0,f.createContext)({value:o,subscribe:()=>()=>{}}),t=e.Provider,r=({value:n,children:s})=>{let c=(0,f.useRef)(null),l=(0,f.useRef)(new Set);return c.current||(c.current={value:n,subscribe:i=>(l.current.add(i),()=>l.current.delete(i))}),(0,f.useEffect)(()=>{c.current&&(Object.is(c.current.value,n)||(c.current.value=n,l.current.forEach(i=>i())))},[n]),g.default.createElement(t,{value:c.current},s)};return e.Provider=r,e},de=(o,e,t=R)=>{let r=(0,f.useContext)(o),n=(0,f.useRef)(void 0),s=(0,g.useMemo)(()=>e||(i=>i),[e]),c=(0,f.useCallback)(()=>{let i=s(r.value);if(t&&n.current!==void 0){let u=n.current;if(t(u,i))return n.current}return n.current=i,i},[r.value,s,t]),l=()=>s(r.value);return(0,f.useSyncExternalStore)(r.subscribe,c,l)};function j(o,e){let t;try{t=o()}catch{return}return{getItem:n=>{var s;let c=i=>i===null?null:JSON.parse(i,e?.reviver),l=(s=t.getItem(n))!=null?s:null;return l instanceof Promise?l.then(c):c(l)},setItem:(n,s)=>t.setItem(n,JSON.stringify(s,e?.replacer)),removeItem:n=>t.removeItem(n)}}var T=o=>e=>{try{let t=o(e);return t instanceof Promise?t:{then(r){return T(r)(t)},catch(r){return this}}}catch(t){return{then(r){return this},catch(r){return T(r)(t)}}}},z=(o,e)=>(t,r,n)=>{let s={storage:j(()=>localStorage),partialize:a=>a,version:0,merge:(a,h)=>({...h,...a}),...e},c=!1,l=new Set,i=new Set,u=s.storage;if(!u)return o((...a)=>{t(...a)},r,n);let b=()=>{let a=s.partialize({...r()});return u.setItem(s.name,{state:a,version:s.version})},M=n.setState;n.setState=(a,h)=>{M(a,h),b()};let m=o((...a)=>{t(...a),b()},r,n);n.getInitialState=()=>m;let p,C=()=>{var a,h;if(!u)return;c=!1,l.forEach(d=>{var v;return d((v=r())!=null?v:m)});let S=((h=s.onRehydrateStorage)==null?void 0:h.call(s,(a=r())!=null?a:m))||void 0;return T(u.getItem.bind(u))(s.name).then(d=>{if(d)if(typeof d.version=="number"&&d.version!==s.version){if(s.migrate)return[!0,s.migrate(d.state,d.version)]}else return[!1,d.state];return[!1,void 0]}).then(d=>{var v;let[N,D]=d;if(p=s.merge(D,(v=r())!=null?v:m),t(p,!0),N)return b()}).then(()=>{S?.(p,void 0),p=r(),c=!0,i.forEach(d=>d(p))}).catch(d=>{S?.(void 0,d)})};return n.persist={setOptions:a=>{s={...s,...a},a.storage&&(u=a.storage)},clearStorage:()=>{u?.removeItem(s.name)},getOptions:()=>s,rehydrate:()=>C(),hasHydrated:()=>c,onHydrate:a=>(l.add(a),()=>{l.delete(a)}),onFinishHydration:a=>(i.add(a),()=>{i.delete(a)})},s.skipHydration||C(),p||m},L=z;var me=(o,e)=>{let{onEnhancedRehydrateStorage:t,...r}=e,n;return L((...s)=>(n=s[0],o(...s)),{onRehydrateStorage:s=>{t?.(async()=>{try{let i=await(e.storage||localStorage).getItem(e.name);if(i){let u=typeof i=="string"?JSON.parse(i):i;n(u.state)}}catch{}},s)},...r})};var ge=o=>{let e=o;e.use={};for(let t of Object.keys(e.getState()))e.use[t]=()=>e(r=>r[t]);return e};export{O as a,A as b,U as c,F as d,B as e,ne as f,V as g,ue as h,de as i,me as j,ge as k};
